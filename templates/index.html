{% extends 'base.html' %}

{% block content %}
<h1>{% block title %} MediaSort {% endblock %}</h1>

{% for set in sets %}
{% set set_id = loop.index0 %}
<div class="card bg-light pb-2">
    <div class="container mt-2">
      <div class="row">
        <div class="col-8"><h4>{{ set.start.strftime("%A %-d %B %Y at %H:%M") }}{% if set.start != set.end %} - {{ set.end.strftime("%H:%M") }}{% endif %}</h4>
        </div>
        <div class="col-4 text-right">
	      <span class="badge badge-primary">{{ set.set | length }} photo{% if set.set|length > 1 %}s{% endif %}</span>
	    </div>
	  </div>
	</div>

	<div class="container">
	<div class="row">
	{% for item in set.set[0:thumbnails] %}
	{% set i = loop.index0 %}
	  <div class="col-lg-4 col-md-6 col-12 mb-4">
		  <div class="card h-100">
			<a href="thumbnail/1200/{{ set_id }}/{{ i }}.jpg" target="_blank"><img src="thumbnail/{{ set_id }}/{{ i }}.jpg" loading="lazy" class="card-img-top" /></a>
			<!--<a class="remove-from-set" data-set="{{ set_id }}" data-item="{{ i }}" href="javascript:undefined"><i class="fas fa-unlink"></i></a>-->
			<form action="/remove/{{ set.id }}/{{ i }}" method="post" class="form-inline">
				<button type="submit"><i class="fas fa-unlink"></i>Remove from set</button>
			</form>
			<div class="card-body"><p class="card-text"><small class="text-muted">{{item.orig_filename}}</small></p></div>
		  </div>
	  </div>
	{% endfor %}
	</div>
	</div>

  <div class="container">
  <form action="/set/{{ set.id }}" method="post" class="form-inline">
     <label class="sr-only" for="name">Name</label>
     <input type="text" name="name" placeholder="Name" class="form-control typeahead" value="{{ set.name }}" />
	 <input type="hidden" name="set_id" value="{{ set.id }}">
     <button type="submit" name="action" value="save_date" class="btn btn-primary ml-2">Save with date</button>
     <button type="submit" name="action" value="save_no_date" class="btn btn-secondary ml-2">Save without date</button>
     <button type="button" class="btn btn-danger ml-2" data-toggle="modal" data-target="#confirmDelete">Delete</button>
  </form>
  </div>
</div>
<hr>
{% endfor %}

{% if sets|length == 0 %}
<h2>There is nothing to sort</h2>

<p>If you were expecting something, then check the configuration.</p>
{% endif %}

<!-- Modal -->
<div class="modal fade" id="confirmDelete" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form action="" method="post" class="form-inline">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteLabel">Are you sure?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this set? All photos in it will be moved to the delete directory.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger" name="action" value="delete">Delete</button>
      </div>
    </div>
  </form>
  </div>
</div>

<script type="text/javascript">
$('#confirmDelete').on('show.bs.modal', function (event) {
  var id = $(event.relatedTarget).parent().find("input[name='set_id']").val()
  $(this).find('.modal-dialog form').attr('action', '/set/' + id);
});

/*
$(".remove-from-set").click(function() {
    alert($(this).data('set'));
	$.ajax({
       url: '/remove/' + $(this).data('set') + '/' + $(this).data('item'),
       type: 'DELETE',
       success: function(result) {
         window.location.reload();
		 return false;
    }
});
});
*/

<!-- The typeahead stuff -->

var names = new Bloodhound({
  datumTokenizer: Bloodhound.tokenizers.whitespace,
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  prefetch: 'names.json'
});

$('.typeahead').typeahead({
  hint: true,
  highlight: true,
  minLength: 0
},
{
  name: 'name',
  source: names
});


</script>

<!--
<sdsfsdftyle>

.thumbnail-container form { 
  position: relative; 
}
.thumbnail-container form button { 
  display: block; 
}

.thumbnail-container form button { 
  position: absolute; 
  bottom: 15px; 
  left: 10px;
  transition: all 200ms ease-in-out;
  opacity: 0.0;
}

.thumbnail-container form button {
  border: 0;
}

.thumbnail-container a:hover + form button { 
  opacity: 1.0;
}

.thumbnail-container form button:hover { 
  opacity: 1.0;
}


</sdsfsdftyle>
-->

{% endblock %}